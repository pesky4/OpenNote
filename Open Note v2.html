<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Open Note</title>
	<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600;700&display=swap" rel="stylesheet">
	<style>
		:root {
			--accent: #007acc;
			--bg-header: #1b1b1b;
			--bg-editor: #1e1e1e;
			--text-header: #ffffff;
			--text-editor: #d4d4d4;
			--text-gutter: #606060;
			--text-footer: #ffffff;
			--active-line-text: #ffffff;
			--dynamic-outline: rgba(255, 255, 255, 0.4);
			--slider-contrast: rgba(255, 255, 255, 0.2);
			--btn-secondary-bg: rgba(127, 127, 127, 0.2);
			--text-placeholder: rgba(255, 255, 255, 0.3);
			/* Logic-driven Glow Variable */
			--logo-glow: none;
		}

		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
			font-family: 'Fira Code', monospace;
			/* Font Sharpness Fix */
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
			text-rendering: optimizeLegibility;
		}

		::-webkit-scrollbar {
			width: 10px;
		}

		::-webkit-scrollbar-track {
			background: transparent;
		}

		::-webkit-scrollbar-thumb {
			background: var(--accent);
			border-radius: 10px;
			border: 3px solid transparent;
			background-clip: content-box;
		}

		body {
			background: #121212;
			color: var(--text-editor);
			height: 100vh;
			display: flex;
			flex-direction: column;
			overflow: hidden;
			font-weight: 400;
		}

		header {
			height: 60px;
			background: var(--bg-header);
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 0 20px;
			border-bottom: 1px solid rgba(127, 127, 127, 0.1);
			z-index: 1001;
		}

		.logo {
			font-weight: 700;
			color: var(--accent);
			font-size: 1.35rem;
			letter-spacing: -0.5px;
			user-select: none;
			/* Dynamic shadow multi-layered to prevent blurriness */
			text-shadow: var(--logo-glow);
			transition: text-shadow 0.15s ease-out;
			transform: translateZ(0);
		}

		.btn {
			background: var(--accent);
			color: var(--text-footer);
			border: none;
			padding: 8px 16px;
			border-radius: 6px;
			cursor: pointer;
			font-weight: 600;
			font-size: 0.85rem;
			transition: all 0.2s;
		}

		.btn:hover {
			opacity: 0.9;
		}

		.btn.secondary {
			background: var(--btn-secondary-bg);
			color: var(--text-header);
		}

		.btn.danger {
			background: var(--btn-secondary-bg);
			border: 1px solid var(--accent);
			color: var(--text-header);
			margin-top: 8px;
			width: 100%;
			padding: 6px;
			font-size: 0.75rem;
		}

		.btn.danger:hover {
			background: rgba(255, 50, 50, 0.8);
			border-color: #ff3232;
			color: white;
			opacity: 1;
		}

		.editor-container {
			flex: 1;
			display: flex;
			background: var(--bg-editor);
			overflow: hidden;
		}

		.gutter {
			min-width: 40px;
			width: min-content;
			background: rgba(0, 0, 0, 0.1);
			color: var(--text-gutter);
			text-align: right;
			padding: 20px 12px 0 15px;
			font-weight: 400;
			font-size: 14px;
			line-height: 1.6;
			user-select: none;
			border-right: 1px solid rgba(0, 0, 0, 0.05);
			overflow: hidden;
			white-space: nowrap;
		}

		.gutter div.active-line {
			color: var(--active-line-text);
			font-weight: 700;
		}

		#editor {
			flex: 1;
			background: transparent;
			color: var(--text-editor);
			border: none;
			outline: none;
			padding: 20px;
			font-weight: 600;
			font-size: 14px;
			line-height: 1.6;
			resize: none;
			white-space: pre;
			overflow-y: auto;
			caret-color: var(--text-editor);
			tab-size: 4;
			-moz-tab-size: 4;
		}

		#editor::placeholder {
			color: var(--text-placeholder);
			opacity: 1;
		}

		footer {
			height: 40px;
			background: var(--accent);
			color: var(--text-footer);
			display: grid;
			grid-template-columns: 1fr auto 1fr;
			align-items: center;
			padding: 0 20px;
			font-size: 0.8rem;
			font-weight: 700;
		}

		.footer-left {
			justify-self: start;
		}

		.footer-right {
			justify-self: end;
			opacity: 0.8;
		}

		.filename-container {
			display: flex;
			align-items: center;
			background: transparent;
			border: 1px solid var(--dynamic-outline);
			padding: 2px 12px;
			border-radius: 6px;
		}

		.filename-container input {
			background: transparent;
			border: none;
			color: inherit;
			font-weight: 700;
			font-size: 0.85rem;
			width: 220px;
			outline: none;
			text-align: center;
		}

		#settingsMenu {
			display: none;
			position: absolute;
			top: 65px;
			right: 20px;
			background: var(--bg-header);
			color: var(--text-header);
			border: 1px solid rgba(127, 127, 127, 0.2);
			border-radius: 10px;
			padding: 18px;
			width: 240px;
			z-index: 1000;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
		}

		.section-title {
			font-size: 0.85rem;
			margin-bottom: 12px;
			font-weight: 700;
			text-decoration: underline;
			text-underline-offset: 4px;
			display: block;
		}

		label {
			display: block;
			font-size: 0.7rem;
			margin-bottom: 6px;
			font-weight: 600;
		}

		input[type="range"] {
			width: 100%;
			cursor: pointer;
			accent-color: var(--accent);
			background: var(--slider-contrast);
			border-radius: 5px;
			height: 6px;
			appearance: none;
			outline: none;
		}

		input[type="range"]::-webkit-slider-thumb {
			appearance: none;
			width: 14px;
			height: 14px;
			background: var(--text-header);
			border-radius: 50%;
			cursor: pointer;
		}

		.menu-item {
			margin-bottom: 10px;
		}
	</style>
</head>

<body>

	<header id="appHeader">
		<div class="logo">Open Note</div>
		<button class="btn secondary" id="settingsBtn" onclick="toggleMenu(event)">Settings</button>

		<div id="settingsMenu" onclick="event.stopPropagation()">
			<div class="section-title">Appearance:</div>
			<div class="menu-item">
				<label>Theme color:</label>
				<input type="color" id="accentInput" value="#007acc" style="width:100%; height:28px; border:none; border-radius:4px; background:none; cursor:pointer;">
      </div>
				<div class="menu-item">
					<label>Header brightness:</label>
					<input type="range" id="headerSlider" min="0" max="255" value="27">
      </div>
					<div class="menu-item">
						<label>Editor brightness:</label>
						<input type="range" id="editorSlider" min="0" max="255" value="30">
      </div>

						<button class="btn danger" id="resetBtn" onclick="resetTheme()">Reset Theme</button>

						<hr style="border:0; height:1px; background:rgba(127,127,127,0.2); margin:15px 0;">

						<div class="section-title">File Options:</div>
						<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
							<button class="btn secondary" style="padding: 6px;" onclick="importDoc()">Import</button>
							<button class="btn secondary" style="padding: 6px;" onclick="exportDoc()">Export</button>
						</div>
					</div>
	</header>

	<div class="editor-container">
		<div class="gutter" id="gutter"></div>
		<textarea id="editor" spellcheck="false" placeholder="Start typing..."></textarea>
	</div>

	<footer>
		<div class="footer-left">
			<div id="stats">Lines: 1 | Chars: 0</div>
		</div>
		<div class="filename-container">
			<input type="text" id="fileNameInput" placeholder="Untitled" value="Untitled-Note">
			<span style="font-size: 0.7rem; margin-left: 4px; opacity: 0.8;">.txt</span>
		</div>
		<div class="footer-right">v2.4</div>
	</footer>

	<script>
		const editor = document.getElementById('editor');
    const gutter = document.getElementById('gutter');
    const fileNameInput = document.getElementById('fileNameInput');
    const settingsMenu = document.getElementById('settingsMenu');

    function updateEditor() {
      const val = editor.value;
      const lines = val.split('\n');
      const cursorPosition = editor.selectionStart;
      const currentLine = val.substr(0, cursorPosition).split('\n').length;
      
      let nums = '';
      for (let i = 1; i <= lines.length; i++) {
        const activeClass = (i === currentLine) ? 'active-line' : '';
        nums += `<div class="${activeClass}">${i}</div>`;
      }
      
      gutter.innerHTML = nums;
      document.getElementById('stats').innerText = `Lines: ${lines.length} | Chars: ${val.length}`;
      localStorage.setItem('op_content_simple', val);
      localStorage.setItem('op_filename', fileNameInput.value);
    }

    editor.oninput = editor.onclick = editor.onkeyup = updateEditor;
    editor.onscroll = () => { gutter.scrollTop = editor.scrollTop; };

    editor.addEventListener('keydown', function(e) {
      if (e.key === 'Tab') {
        e.preventDefault();
        const start = this.selectionStart;
        const end = this.selectionEnd;
        this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);
        this.selectionStart = this.selectionEnd = start + 1;
        updateEditor();
      }
    });

    function toggleMenu(e) {
      e.stopPropagation();
      settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
    }

    function hexToRgb(hex) {
      const r = parseInt(hex.slice(1,3), 16);
      const g = parseInt(hex.slice(3,5), 16);
      const b = parseInt(hex.slice(5,7), 16);
      return {r, g, b};
    }

    function applyTheme() {
      const acc = document.getElementById('accentInput').value;
      const headV = parseInt(document.getElementById('headerSlider').value);
      const editV = parseInt(document.getElementById('editorSlider').value);

      document.documentElement.style.setProperty('--accent', acc);
      document.documentElement.style.setProperty('--bg-header', `rgb(${headV},${headV},${headV})`);
      document.documentElement.style.setProperty('--bg-editor', `rgb(${editV},${editV},${editV})`);
      
      const headText = headV > 130 ? '#1a1a1a' : '#ffffff';
      const contrastBg = headV > 130 ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.2)';
      
      const accRgb = hexToRgb(acc);
      const colorDist = Math.abs(accRgb.r - headV) + Math.abs(accRgb.g - headV) + Math.abs(accRgb.b - headV);
      
      if (colorDist < 135) {
        const shadowColor = headV > 130 ? 'rgba(0,0,0,0.4)' : 'rgba(255,255,255,0.4)';
        document.documentElement.style.setProperty('--logo-glow', `1px 1px 0px ${shadowColor}, -1px -1px 0px ${shadowColor}, 0 0 8px ${shadowColor}`);
      } else {
        document.documentElement.style.setProperty('--logo-glow', 'none');
      }

      document.documentElement.style.setProperty('--text-header', headText);
      document.documentElement.style.setProperty('--slider-contrast', contrastBg);
      document.documentElement.style.setProperty('--btn-secondary-bg', contrastBg);
      
      const editText = editV > 130 ? '#1a1a1a' : '#d4d4d4';
      const placeholderColor = editV > 130 ? 'rgba(0,0,0,0.25)' : 'rgba(255,255,255,0.3)';
      
      document.documentElement.style.setProperty('--text-editor', editText);
      document.documentElement.style.setProperty('--text-placeholder', placeholderColor);
      
      const activeLineText = editV > 130 ? '#000000' : '#ffffff';
      document.documentElement.style.setProperty('--active-line-text', activeLineText);

      const r = parseInt(acc.slice(1,3), 16), g = parseInt(acc.slice(3,5), 16), b = parseInt(acc.slice(5,7), 16);
      const bright = (r*299 + g*587 + b*114) / 1000;
      const contrastColor = bright > 150 ? '#000000' : '#ffffff';
      document.documentElement.style.setProperty('--text-footer', contrastColor);
      document.documentElement.style.setProperty('--dynamic-outline', contrastColor === '#000000' ? 'rgba(0,0,0,0.3)' : 'rgba(255,255,255,0.3)');

      localStorage.setItem('op_theme_accent', acc);
      localStorage.setItem('op_theme_header_val', headV);
      localStorage.setItem('op_theme_editor_val', editV);
    }

    function resetTheme() {
      if (confirm("Reset theme to default?")) {
        localStorage.removeItem('op_theme_accent');
        localStorage.removeItem('op_theme_header_val');
        localStorage.removeItem('op_theme_editor_val');
        
        document.getElementById('accentInput').value = "#007acc";
        document.getElementById('headerSlider').value = "27";
        document.getElementById('editorSlider').value = "30";
        
        applyTheme();
      }
    }

    function exportDoc() {
      const name = fileNameInput.value.trim() || "Note";
      const blob = new Blob([editor.value], {type: 'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${name}.txt`;
      a.click();
    }

    function importDoc() {
      const input = document.createElement('input');
      input.type = 'file';
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = ev => { 
          editor.value = ev.target.result; 
          fileNameInput.value = file.name.replace(/\.[^/.]+$/, "");
          updateEditor(); 
        };
        reader.readAsText(file);
      };
      input.click();
    }

    window.onclick = () => settingsMenu.style.display = 'none';

    document.getElementById('accentInput').addEventListener('input', applyTheme);
    document.getElementById('headerSlider').addEventListener('input', applyTheme);
    document.getElementById('editorSlider').addEventListener('input', applyTheme);

    window.onload = () => {
      const savedText = localStorage.getItem('op_content_simple');
      const savedName = localStorage.getItem('op_filename');
      if (savedText) editor.value = savedText;
      if (savedName) fileNameInput.value = savedName;

      const savedAccent = localStorage.getItem('op_theme_accent');
      const savedHeadVal = localStorage.getItem('op_theme_header_val');
      const savedEditVal = localStorage.getItem('op_theme_editor_val');

      if (savedAccent) document.getElementById('accentInput').value = savedAccent;
      if (savedHeadVal) document.getElementById('headerSlider').value = savedHeadVal;
      if (savedEditVal) document.getElementById('editorSlider').value = savedEditVal;

      applyTheme();
      updateEditor();
    };
	</script>
</body>

</html>
